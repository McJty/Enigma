# In game it is possible to tag items and objects using the 'tagger'

on setup:
    log "root.setup"
    #restore "startsnapshot"
    position testpos 808 4 1903 0
    position lockeddoor 800 4 1903 0
    position exitposition 800 4 1900 0
    position changeblock 808 4 1900 0
    position tppos 820 4 1900 0

    blockstate diamond:
        name "minecraft:diamond_block"
        meta 0
    blockstate emerald:
        name "minecraft:emerald_block"
        meta 0

    createparticles smoke:
        name "smoke"
        amount 100
        offset 0 0 0
        speed .20

    state changeblock diamond

    itemstack mysteriouskey:
        name "enigma:key"
        meta 1
        description "Mysterious key"

on init:
    log "root.init"

on activate:
    log "root.activate"
    var counter 0
    state main beginroom

pscope "player" true:
    on repeat 50:
        if distance(tppos) < 5:
            message "Close!"

scope "diamond" state(changeblock) == diamond:
    on activate:
        log "diamond.activate"
    on rightclickblock changeblock:
        log "diamond.rightclickblock"
        setblock changeblock emerald
        state changeblock emerald
        particle changeblock "smoke"
        cancel

scope "emerald" state(changeblock) == emerald:
    on activate:
        log "emerald.activate"
    on rightclickblock changeblock:
        log "emerald.rightclickblock"
        setblock changeblock diamond
        state changeblock diamond
        particle changeblock "smoke"
        cancel


on login:
    log "Player logged in!"
    message "Hoi player!"
    pstate health bad

pscope "playerhealth" pstate(health) == bad:
    on activate:
        message "Woot"
        log "Woot"

on rightclickitem mysteriouskey:
    message "This is a really mysterious key"
    message "you wonder what you can use it for"

scope "begin" state(main) == beginroom:
    on setup:
        log "begin.setup"
    on init:
        log "begin.init"
    on activate:
        log "begin.activate"
    on deactivate:
        log "begin.deactivate"

    on delay 80:
        log "We waited 4s!"

    on repeat 40:
        log "ping: " + $counter
        var counter $counter+1

    on rightclickblock testpos:
        message "You receive a mysterious key"
        give mysteriouskey
        cancel

    on rightclickblock lockeddoor:
        log "testtesttesttest"
        if hasitem(mysteriouskey):
            message "The door opens!"
            sound lockeddoor "enigma:locking"
            take mysteriouskey
        else:
            message "You need a key!"
        cancel

    on rightclickblock exitposition:
        state main theend
        cancel

scope "end" state(main) == theend:
    on setup:
        log "end.setup"
    on init:
        log "end.init"
    on activate:
        log "end.activate"
    on deactivate:
        log "end.deactivate"

    on rightclickblock lockeddoor:
        teleport tppos
        sound tppos "minecraft:entity.endermen.teleport"

